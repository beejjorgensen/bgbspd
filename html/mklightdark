#!/bin/sh

LIGHT=pygments
DARK=zenburn

makehtml() {
    local theme="$1"
    local themename="$2"

    echo '```c\nint main(){}\n```' | \
        pandoc --highlight-style=${themename} -s | \
        sed -n '/<style>/,/<\/style>/p' | \
        sed '/<style>/a\
   @media (prefers-color-scheme: '$theme') {
' | \
       sed '/<\/style>/i\
    }
'
}

override() {
cat<<'_EOF_'
<!-- Hand-rolled dark mode overrides for Pandoc's default CSS -->
<!-- Credit: GitHub user ardabbour -->
  <style>
   @media (prefers-color-scheme: dark) {
    html {
      color: #abb2bf;
      background-color: #282c34;
    }
    a {
      color: #abb2bf;
    }
    a:visited {
      color: #abb2bf;
    }
    hr {
      background-color: #abb2bf;
    }
    table {
      border-top: 1px solid #abb2bf;
      border-bottom: 1px solid #abb2bf;
    }
    th {
      border-top: 1px solid #abb2bf;
    }
    tbody {
      border-top: 1px solid #abb2bf;
      border-bottom: 1px solid #abb2bf;
    }
    blockquote {
      border-left: 2px solid #282c34;
      color: #5c6370;
    }
    figure > embed {
        filter: invert(0.8); /* yuck -- this part is Beej's fault*/
    }
   }
  </style>
_EOF_
}

(
    echo '<!-- Generated by the mklightdark script -->'
    echo '<!-- Modify that script to change syntax highlighting -->'
    makehtml light "$LIGHT"
    makehtml dark "$DARK"
    override
) > lightdark.html

